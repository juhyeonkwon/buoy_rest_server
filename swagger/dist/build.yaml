openapi: 3.0.0
info:
  description: DXDATA의 스마트 관제시스템(Buoy) API입니다.
  version: 1.0.0
  title: Smart Control System API
  contact:
    email: dxdata@dxdata.co.kr
    url: 'http://www.dxdata.co.kr'
basePath: /
tags:
  - name: main
    description: 메인 화면 API
  - name: detail
    description: 상세보기 API
  - name: legacy
    description: 사용되지 않는 API
paths:
  /main/data:
    get:
      tags:
        - main
      description: |
        # 현재 자신의 위치기반으로 데이터를 가져옵니다.

        ## 기상청에서 가져오는 기상 정보입니다.

            "meteo_val": {

            "data": {
            
              "humidity": 습도 %
              
              "rain_amt_hour": 강수량 없으면 강수없음, 그외에는 mm

              "rain_code": 강수코드, 0 : 없음, 1 : 비, 2 : 비/눈, 3 : 눈, 5 : 빗방울, 6 : 빗방울 눈랄림, 7: 눈날림
            
              "sky": 하늘상태, 1 : 맑음, 3 : 구름많음, 4 : 흐림

              "sn_wind": 남북 바람 m/s

              "temperature": 온도

              "thunder": 낙뢰 코드,
            
              "we_wind": 동서 바람 m/s,

              "wind_direction": 풍향 deg,

              "wind_velocity": 퐁숙 m/s

            },

            "region" : 지역


        ## 관측부이에서 가져오는 해상정보들입니다.


            "obs_data": {

              "Salinity": 염분 psu

              "air_press": 기압 hpa

              "air_temp": 기온

              "record_time": 측정 시간

              "tide_level": 조위 cm

              "water_temp": 수온

              "wind_dir": 풍향 deg

              "wind_gust": 돌풍 m/s

              "wind_speed": 풍속 m/s

            }


        ## 조류 속도입니다.

            "tidal": {

              "current_direct": 방향 deg,

              "current_speed": 속도 cm/s

            }


        ## 파고입니다.

            "wave_hight": {

              "record_time": 측정시간

              "wave_height": 파고 m

            }
      parameters:
        - in: query
          name: latitude
          schema:
            type: string
          example: 35.1513466
          required: true
        - in: query
          name: longitude
          schema:
            type: string
          example: 128.1001125
          required: true
      responses:
        '200':
          description: 메인 지역별 현재 데이터
          content:
            apllication/json:
              schema:
                $ref: '#/components/schemas/MainData'
  /main/group:
    get:
      tags:
        - main
      description: 메인에서 각 부이 그룹별 현재 데이터를 가져옵니다.
      responses:
        '200':
          description: 각 부이 그룹별 현재 데이터
          content:
            apllication/json:
              schema:
                $ref: '#/components/schemas/BuoyGroupMain'
  /main/group/total:
    get:
      tags:
        - main
      description: 메인에서 부이 그룹의 전체 평균 데이터를 가져옵니다.
      responses:
        '200':
          description: 각 부이 그룹의 전체 평균 데이터
  /detail/group/list:
    get:
      tags:
        - detail
      description: 상세보기 화면에서 그룹 리스트를 보여줍니다.
      responses:
        '200':
          description: 각 그룹 리스트
          content:
            apllication/json:
              schema:
                $ref: '#/components/schemas/GroupList'
  /detail/group:
    get:
      tags:
        - detail
      description: |
        # 그룹의 라인별 상세 정보를 가져옵니다. 

        ## 라인별로 라인의 현재 정보와, 라인의 히스토리, 라인안에 있는 스마트 부표의 데이터들을 가져옵니다.

        ## 라인별로 값은 line_라인번호로 객체형식으로 받습니다.



        ### 라인에 속해이는 부표들의 값들을 가져옵니다.

                "_buoy_list": [

                  {


                    "latitude": 좌표

                    "longitude": 좌표

                    "model": 모델 이름

                    "model_idx": 모델 번호

                    "salinity": 부표의 현재 염도 psu

                    "warn": 경고 여부

                    "water_temp": 부표의 현재 온도

                    "height": 높이

                    "weight": 부표의 현재 무게

                  },
               
                ],

        ### 라인 데이터의 7일치 기록을 가져옵니다.

                "_history": [
                  {
                    "date": 기록된 날짜입니다
                    "group_id": 속한 그룹의 id
                    "group_name": 속한 그룹의 이름
                    "latitude": 라인의 lat,
                    "longitude": 라인의 lng,
                    "line": 라인 번호,
                    "salinity": 평균 염분입니다 psu 단위입니다.,
                    "water_temp":평균 온도,
                    "weight": 43.529666900634766
                    "height": 평균 높이

                  }
                ],

        ### 현재 라인의 평균 정보 입니다.

                "group_name": 라인이 속한 이름입니다.
                "line": 라인 번호입니다.,
                "latitude": 라인의 lat,
                "longitude": 라인의 lng,
                "salinity": 평균 염분입니다 psu 단위입니다.,
                "water_temp": 평균 온도,
                "weight": 평균 무게입니다.
                "height": 평균 높이입니다.

              },
      parameters:
        - in: query
          name: group
          schema:
            type: string
          example: A
          required: true
      responses:
        '200':
          description: 그룹의 라인별 상세 정보
          content:
            apllication/json:
              schema:
                $ref: '#/components/schemas/GroupDetailLine'
  /detail/buoy/history:
    get:
      tags:
        - detail
      description: Buoy의 일주일간 기록을 가져옵니다.
      parameters:
        - in: query
          name: model
          schema:
            type: string
          example: buoy_1
          required: true
      responses:
        '200':
          description: Buoy의 일주일간 기록
          content:
            apllication/json:
              schema:
                $ref: '#/components/schemas/BuoyHistory'
  /main/region:
    get:
      tags:
        - legacy
      description: '메인에서 지역별 현재 데이터를 가져옵니다. 파고는 m. 조류 속도는 cm/s. 풍속 돌풍은 m/s, 기압은 hPa, 조위는 cm, 염분은 psu, 그외의 방향은 deg입니다.'
      parameters:
        - in: query
          name: location
          schema:
            type: string
            enum:
              - tongyeong
              - geojedo
          required: true
      responses:
        '200':
          description: 메인 지역별 현재 데이터
          content:
            apllication/json:
              schema:
                $ref: '#/components/schemas/MainData'
components:
  schemas:
    MainData:
      type: object
      properties:
        meteo_val: object
        obs_data: object
        tidal: object
        wave_hight: object
      example:
        meteo_val:
          data:
            humidity: 15
            rain_amt_hour: 강수없음
            rain_code: 0
            sky: 1
            sn_wind: 2
            temperature: 24
            thunder: 0
            we_wind: 0.1
            wind_direction: 205
            wind_velocity: 2
          region: 진주시
        obs_data:
          Salinity: '33.7'
          air_press: '1013.7'
          air_temp: '14.5'
          record_time: '2022-04-13 15:13:00'
          tide_level: '122.0'
          water_temp: '13.9'
          wind_dir: '112.0'
          wind_gust: '6.6'
          wind_speed: '3.4'
        tidal:
          current_direct: '215.8'
          current_speed: '34.0'
        wave_hight:
          record_time: '2022-04-13 15:00'
          wave_height: '2.3'
    BuoyGroupMain:
      type: object
      required:
        - group_id
        - group_name
        - group_latitude
        - group_longitude
        - group_water_temp
        - group_salinity
        - group_height
        - group_weight
        - plain_buoy
        - smart_buoy
        - region
      properties:
        group_id:
          type: float
        group_name:
          type: string
        group_latitude:
          type: double
        group_longitude:
          type: double
        group_water_temp:
          type: float
        group_salinity:
          type: float
        group_height:
          type: float
        group_weight:
          type: float
        plain_buoy:
          type: integer
        smart_buoy:
          type: integer
        region:
          type: string
      example:
        group_id: 1
        group_name: A
        group_latitude: 32.3333
        group_longitude: 32.4444
        group_water_temp: 3.22
        group_salinity: 3.5
        group_height: 5.4
        group_weight: 2.3
        plain_buoy: 100
        smart_buoy: 30
        region: 통영시
    GroupList:
      type: object
      required:
        - group_id
        - group_name
      properties:
        group_id:
          type: float
        group_name:
          type: string
      example:
        group_id: 1
        group_name: A
    GroupDetailLine:
      type: object
      required:
        - _buoy_list
        - _history
        - group_name
        - line
        - latitude
        - longitude
        - water_temp
        - salinity
        - height
        - weight
      properties:
        _buoy_list:
          type: object
          properties:
            model:
              type: string
            model_idx:
              type: integer
            latitude:
              type: double
            longitude:
              type: double
            water_temp:
              type: float
            salinity:
              type: float
            height:
              type: float
            weight:
              type: float
            warn:
              type: integer
        _history:
          type: object
          properties:
            date:
              type: string
            group_id:
              type: integer
            group_name:
              type: string
            line:
              type: integer
            latitude:
              type: double
            longitude:
              type: double
            salinity:
              type: float
            water_temp:
              type: float
            height:
              type: float
            weight:
              type: float
        group_name:
          type: string
        line:
          type: integer
        latitude:
          type: double
        longitude:
          type: double
        water_temp:
          type: float
        salinity:
          type: float
        height:
          type: float
        weight:
          type: float
      example:
        group_name: A
        line: 1
        _buoy_list:
          model: buoy_26
          model_idx: 26
          latitude: 34.7971
          longitude: 128.4601
          salinity: 30.96930694580078
          water_temp: 12.993814468383789
          weight: 46.11586761474609
          height: 13.42252254486084
          warn: 0
        _history:
          date: '2022-04-20'
          group_id: 3
          group_name: C
          line: 1
          latitude: 32.3333
          longitude: 32.4444
          water_temp: 3.22
          salinity: 3.5
          height: 5.4
          weight: 2.3
        latitude: 34.7971
        longitude: 128.4603
        salinity: 31.11802520751953
        water_temp: 13.078953552246094
        weight: 43.428182983398436
        height: 13.810451889038086
    BuoyHistory:
      type: object
      required:
        - avg_height
        - avg_salinity
        - avg_w_temp
        - avg_weight
        - date
        - model
      properties:
        avg_height:
          type: float
        avg_salinity:
          type: float
        avg_w_temp:
          type: float
        avg_weight:
          type: float
        date:
          type: string
        model:
          type: string
      example:
        avg_height: 14.394352
        avg_salinity: 31.537668
        avg_w_temp: 12.865586
        avg_weight: 42.267906
        date: 2022-04-19T00:00:00.000Z
        model: buoy_1
    User:
      type: object
      required:
        - id
        - password
      properties:
        id:
          type: string
        password:
          type: string
      example:
        id: test3
        password: test
  securitySchemes:
    JWT:
      type: http
      scheme: bearer
      bearerFormat: JWT
